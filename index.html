<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>éƒ¨é¦–å¤§æŒ‘æˆ°</title>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@500;700;900&display=swap');

    * { box-sizing: border-box; } /* ç¢ºä¿ padding ä¸æœƒæ’é–‹å¯¬åº¦ */

    body { 
        font-family: 'Noto Sans TC', 'Microsoft JhengHei', sans-serif; 
        background-color: #f0f8ff; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; 
        min-height: 100vh; margin: 0; padding: 10px;
    }

    .container { 
        background-color: white; padding: 1.5rem; border-radius: 24px; 
        box-shadow: 0 10px 25px rgba(0,0,0,0.1); text-align: center; 
        width: 100%; max-width: 600px; /* é›»è…¦ç‰ˆæœ€å¤§ 600pxï¼Œæ‰‹æ©Ÿç‰ˆ 100% */
        margin-top: 10px;
    }

    h1 { color: #2c3e50; margin: 0 0 1rem 0; font-size: 1.8rem; }
    
    .status-bar { display: flex; justify-content: space-between; margin-bottom: 1rem; font-size: 1.1rem; font-weight: bold; }
    
    /* é¡Œç›®å€è‡ªé©æ‡‰ */
    .question-box { 
        margin: 15px 0; display: flex; flex-direction: row; 
        align-items: center; justify-content: center; 
        min-height: 220px; background-color: #fafafa;
        border-radius: 20px; border: 2px solid #eee; gap: 5vw; /* ä½¿ç”¨è¦–çª—å¯¬åº¦å–®ä½ */
    }

    .char-main { 
        font-size: clamp(5rem, 25vw, 9rem); /* æ ¹æ“šè¢å¹•å¯¬åº¦è‡ªå‹•ç¸®æ”¾å­—é«” */
        font-weight: 700; color: #2c3e50; line-height: 1; 
    }

    .zhuyin-container {
        position: relative; display: flex; flex-direction: row-reverse;
        align-items: center; border: 3px solid #ffeb3b;
        padding: 15px 10px; background: white; 
        min-width: clamp(60px, 15vw, 90px); border-radius: 12px;
    }

    .zhuyin-symbols { 
        writing-mode: vertical-rl; 
        font-size: clamp(2rem, 10vw, 3.8rem); 
        color: #333; font-weight: 700; text-orientation: upright; 
    }

    .tone-mark { 
        position: absolute; right: -0.7em; top: 50%; transform: translateY(-50%); 
        font-size: clamp(2.5rem, 12vw, 5rem); color: #333; font-weight: 900; 
    }

    .tone-dot { 
        position: absolute; top: -0.9em; left: 50%; transform: translateX(-50%); 
        font-size: clamp(2rem, 10vw, 4rem); color: #333; font-weight: 900; 
    }

    /* é¸é …æŒ‰éˆ•è‡ªé©æ‡‰ */
    .options-grid { 
        display: grid; 
        grid-template-columns: 1fr 1fr; 
        gap: 10px; 
        width: 100%;
    }

    button { 
        background-color: #4CAF50; border: none; color: white; 
        padding: 10px 5px; border-radius: 16px; cursor: pointer; 
        box-shadow: 0 5px #388E3C; 
        display: flex; align-items: center; justify-content: center; 
        gap: 8px; width: 100%;
    }

    .btn-char { font-size: clamp(1.8rem, 8vw, 3.2rem); font-weight: bold; }
    
    .btn-zy-container {
        position: relative; display: flex; padding: 3px 8px;
        background: rgba(0,0,0,0.15); border-radius: 6px;
        min-width: 35px; justify-content: center;
    }

    .btn-zy-symbols { 
        writing-mode: vertical-rl; 
        font-size: clamp(1rem, 4vw, 1.8rem); 
        text-orientation: upright; line-height: 1.1; 
    }

    .btn-tone { 
        position: absolute; right: -0.3em; top: 50%; transform: translateY(-50%); 
        font-size: clamp(1.2rem, 5vw, 2.5rem); font-weight: 900; color: #fff; 
    }

    .btn-tone-dot { 
        position: absolute; top: -0.6em; left: 50%; transform: translateX(-50%); 
        font-size: clamp(1rem, 4vw, 2rem); font-weight: 900; 
    }

    button:active { transform: translateY(3px); box-shadow: 0 2px #388E3C; }

    button.wrong { background-color: #e74c3c; box-shadow: 0 5px #c0392b; }
    button.correct { background-color: #f1c40f; box-shadow: 0 5px #f39c12; }
    
    .result-screen { display: none; padding: 20px 0; }
    #settings-area { margin-top: 20px; width: 100%; max-width: 600px; }
    #settings-content { display: none; background: #fff; padding: 15px; border-radius: 10px; border: 1px solid #ccc; margin-top: 10px; }
    textarea { width: 100%; border: 1px solid #ddd; padding: 10px; font-size: 1rem; box-sizing: border-box; }

    /* é‡å°è¶…å°è¢å¹•å¾®èª¿ */
    @media (max-width: 360px) {
        .question-box { gap: 15px; min-height: 180px; }
        .container { padding: 1rem; }
    }
</style>
</head>
<body>

<div class="container">
    <div id="game-screen">
        <h1>éƒ¨é¦–å¤§æŒ‘æˆ° ğŸ¯</h1>
        <div class="status-bar">
            <span class="score" id="score-display">åˆ†æ•¸: 0</span>
            <span class="progress" id="progress-display">é¡Œç›®: 1 / --</span>
        </div>
        <div class="question-box">
            <div class="char-main" id="display-char">?</div>
            <div id="zy-box-main" class="zhuyin-container"></div>
        </div>
        <div id="options" class="options-grid"></div>
    </div>

    <div id="result-screen" class="result-screen">
        <h1>æŒ‘æˆ°å®Œæˆï¼ğŸ‰</h1>
        <div style="font-size: 5rem; color: #e74c3c; font-weight: bold;" id="final-score">0</div>
        <div id="wrong-list-container" style="display:none; text-align: left; padding: 10px;">
            <p style="font-weight:bold;">éœ€è¦ç·´ç¿’çš„å­—ï¼š</p>
            <div id="wrong-report" style="background: #fff0f0; padding: 10px; border-radius: 8px; line-height: 1.6; font-size: 0.9rem;"></div>
        </div>
        <button onclick="initGame()" style="width:100%; background:#3498db; color:white; font-size:1.5rem; height:60px; border:none; border-radius:15px; cursor:pointer; margin-top:20px;">å†ç©ä¸€æ¬¡</button>
    </div>
</div>

<div id="settings-area">
    <button id="toggle-btn" onclick="toggleSettings()" style="background:#95a5a6; color:white; padding:10px; border:none; border-radius:8px; cursor:pointer; width: 100%;">âš™ï¸ è¨­å®šé¡Œç›®</button>
    <div id="settings-content">
        <textarea id="words-input" rows="10"></textarea>
        <button onclick="saveAndRestart()" style="background:#34495e; color:white; width:100%; padding:10px; margin-top:5px; border:none; border-radius:8px;">å„²å­˜ä¸¦é–‹å§‹</button>
    </div>
</div>

<script>
    // (JavaScript éƒ¨åˆ†ç¶­æŒåŸæ¨£ï¼Œåƒ…ä¿®æ­£äº†ã€Œé–€ã€çš„å¤šé¤˜å­—å…ƒ)
    const defaultWords = `èµ·(ã„‘ã„§Ë‡),èµ°(ã„—ã„¡Ë‡)
èµ°(ã„—ã„¡Ë‡),èµ°(ã„—ã„¡Ë‡)
ä½ (ã„‹ã„§Ë‡),äºº(ã„–ã„£ËŠ)
åœ¨(ã„—ã„Ë‹),åœŸ(ã„Šã„¨Ë‡)
å·¦(ã„—ã„¨ã„›Ë‡),å·¥(ã„ã„¨ã„¥)
æˆ‘(ã„¨ã„›Ë‡),æˆˆ(ã„ã„œ)
å³(ã„§ã„¡Ë‹),å£(ã„ã„¡Ë‡)
å’Œ(ã„ã„¢Ë‹),å£(ã„ã„¡Ë‡)
å‘(ã„’ã„§ã„¤Ë‹),å£(ã„ã„¡Ë‡)
å‰(ã„‘ã„§ã„¢ËŠ),åˆ€(ã„‰ã„ )
ç©(ã„¨ã„¢ËŠ),ç‰(ã„©Ë‹)
ä¾†(ã„Œã„ËŠ),äºº(ã„–ã„£ËŠ)
å€‘(ã„‡ã„£Ë™),äºº(ã„–ã„£ËŠ)
å¹(ã„”ã„¨ã„Ÿ),å£(ã„ã„¡Ë‡)
é¢¨(ã„ˆã„¥),é¢¨(ã„ˆã„¥)
å¤§(ã„‰ã„šË‹),å¤§(ã„‰ã„šË‹)
è·‘(ã„†ã„ Ë‡),è¶³(ã„—ã„¨ËŠ)
çš„(ã„‰ã„œË™),ç™½(ã„…ã„ËŠ)
åœ(ã„Šã„§ã„¥ËŠ),äºº(ã„–ã„£ËŠ)
ä¸(ã„…ã„¨Ë‹),ä¸€(ã„§)
ç«(ã„ã„¨ã„›Ë‡),ç«(ã„ã„¨ã„›Ë‡)
è»Š(ã„”ã„œ),è»Š(ã„”ã„œ)
é(ã„ã„¨ã„›Ë‹),è¾µ(ã„”ã„¨ã„›Ë‹)
å±±(ã„•ã„¢),å±±(ã„•ã„¢)
æ´(ã„‰ã„¨ã„¥Ë‹),æ°´(ã„•ã„¨ã„ŸË‡)
å€‹(ã„ã„œË‹),äºº(ã„–ã„£ËŠ)
åˆ(ã„§ã„¡Ë‹),åˆ(ã„§ã„¡Ë‹)
åš(ã„—ã„¨ã„›Ë‹),äºº(ã„–ã„£ËŠ)
å‡º(ã„”ã„¨),å‡µ(ã„ã„¢)
å°(ã„’ã„§ã„ Ë‡),å°(ã„’ã„§ã„ Ë‡)
å †(ã„‰ã„¨ã„Ÿ),åœŸ(ã„Šã„¨Ë‡)
é–‹(ã„ã„),é–€(ã„‡ã„£ËŠ)
å¿ƒ(ã„’ã„§ã„£),å¿ƒ(ã„’ã„§ã„£)
è«‹(ã„‘ã„§ã„¥Ë‡),è¨€(ã„§ã„¢ËŠ)
å•(ã„¨ã„£Ë‹),å£(ã„ã„¡Ë‡)
è‰(ã„˜ã„ Ë‡),è‰¸(ã„˜ã„ Ë‡)
å¤©(ã„Šã„§ã„¢),å¤§(ã„‰ã„šË‹)
æœ‰(ã„§ã„¡Ë‡),æœˆ(ã„©ã„Ë‹)
å¤š(ã„‰ã„¨ã„›),å¤•(ã„’ã„§Ë‹)
é«˜(ã„ã„ ),é«˜(ã„ã„ )
æ˜Ÿ(ã„’ã„§ã„¥),æ—¥(ã„–Ë‹)
å°‘(ã„•ã„ Ë‡),å°(ã„’ã„§ã„ Ë‡)
å¤ª(ã„Šã„Ë‹),å¤§(ã„‰ã„šË‹)
é™½(ã„§ã„¤ËŠ),é˜œ(ã„ˆã„¨Ë‹)
äº†(ã„Œã„œË™),äº…(ã„ã„©ã„ËŠ)
æ°´(ã„•ã„¨ã„ŸË‡),æ°´(ã„•ã„¨ã„ŸË‡)
ç (ã„“ã„¨),ç‰(ã„©Ë‹)
å“ª(ã„‹ã„šË‡),å£(ã„ã„¡Ë‡)
å»(ã„‘ã„©Ë‹),å¶(ã„™)
å½©(ã„˜ã„Ë‡),å½¡(ã„•ã„¢)
æ»‘(ã„ã„¨ã„šËŠ),æ°´(ã„•ã„¨ã„ŸË‡)
æ¢¯(ã„Šã„§),æœ¨(ã„‡ã„¨Ë‹)
ä¸Š(ã„•ã„¤Ë‹),ä¸€(ã„§)
å¥½(ã„ã„ Ë‡),å¥³(ã„‹ã„©Ë‡)
æƒ³(ã„’ã„§ã„¤Ë‡),å¿ƒ(ã„’ã„§ã„£)
çˆ¬(ã„†ã„šËŠ),çˆª(ã„“ã„ Ë‡)
çœ‹(ã„ã„¢Ë‹),ç›®(ã„‡ã„¨Ë‹)
æ²’(ã„‡ã„ŸËŠ),æ°´(ã„•ã„¨ã„ŸË‡)
æ£‰(ã„‡ã„§ã„¢ËŠ),æœ¨(ã„‡ã„¨Ë‹)
èŠ±(ã„ã„¨ã„š),è‰¸(ã„˜ã„ Ë‡)
ç³–(ã„Šã„¤ËŠ),ç±³(ã„‡ã„§Ë‡)
ä¸‹(ã„’ã„§ã„šË‹),ä¸€(ã„§)
æ³¡(ã„†ã„ Ë‹),æ°´(ã„•ã„¨ã„ŸË‡)
æ± (ã„”ËŠ),æ°´(ã„•ã„¨ã„ŸË‡)
ç§‹(ã„‘ã„§ã„¡),ç¦¾(ã„ã„œËŠ)
åƒ(ã„‘ã„§ã„¢),å(ã„•ËŠ)
å­(ã„—Ë‡),å­(ã„—Ë‡)
ç©º(ã„ã„¨ã„¥),ç©´(ã„’ã„©ã„Ë‹)
èªª(ã„•ã„¨ã„›),è¨€(ã„§ã„¢ËŠ)
æ—©(ã„—ã„ Ë‡),æ—¥(ã„–Ë‹)
ä½(ã„‰ã„§),äºº(ã„–ã„£ËŠ)
ç”°(ã„Šã„§ã„¢ËŠ),ç”°(ã„Šã„§ã„¢ËŠ)
æ‰¾(ã„“ã„ Ë‡),æ‰‹(ã„•ã„¡Ë‡)
æ˜¯(ã„•Ë‹),æ—¥(ã„–Ë‹)
èª°(ã„•ã„ŸËŠ),è¨€(ã„§ã„¢ËŠ)
é™ª(ã„†ã„ŸËŠ),é˜œ(ã„ˆã„¨Ë‹)
ä»–(ã„Šã„š),äºº(ã„–ã„£ËŠ)
å›(ã„ã„¨ã„ŸËŠ),å£(ã„ã„¡Ë‡)
éŸ³(ã„§ã„£),éŸ³(ã„§ã„£)
åˆ°(ã„‰ã„ Ë‹),åˆ€(ã„‰ã„ )
è°·(ã„ã„¨Ë‡),è°·(ã„ã„¨Ë‡)
å«(ã„ã„§ã„ Ë‹),å£(ã„ã„¡Ë‡)
äºº(ã„–ã„£ËŠ),äºº(ã„–ã„£ËŠ)
å—(ã„‡ã„šË™),å£(ã„ã„¡Ë‡)
ä¹Ÿ(ã„§ã„Ë‡),ä¹™(ã„§Ë‡)
ç¬‘(ã„’ã„§ã„ Ë‹),ç«¹(ã„“ã„¨ËŠ)
å“ˆ(ã„ã„š),å£(ã„ã„¡Ë‡)`;

    let fullDatabase = [];
    let currentQuestions = [];
    let score = 0, currentIdx = 0, pointsPerWord = 0;
    let wrongList = [], hasMistake = false;

    function renderZhuyin(text, containerId) {
        const container = document.getElementById(containerId);
        const tones = ["ËŠ", "Ë‡", "Ë‹", "Ë™"];
        let mainSymbols = "", toneMark = "";
        for (let char of text) {
            if (tones.includes(char)) toneMark = char;
            else mainSymbols += char;
        }
        const toneClass = toneMark === "Ë™" ? "tone-dot" : "tone-mark";
        container.innerHTML = `<div class="zhuyin-symbols">${mainSymbols}</div>${toneMark ? `<div class="${toneClass}">${toneMark}</div>` : ""}`;
    }

    function getZhuyinHTML(text) {
        const tones = ["ËŠ", "Ë‡", "Ë‹", "Ë™"];
        let main = "", tone = "";
        for (let char of text) {
            if (tones.includes(char)) tone = char;
            else main += char;
        }
        const toneClass = tone === "Ë™" ? "btn-tone-dot" : "btn-tone";
        return `<div class="btn-zy-container"><div class="btn-zy-symbols">${main}</div>${tone ? `<div class="${toneClass}">${tone}</div>` : ""}</div>`;
    }

    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playSound(isCorrect) {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.frequency.setValueAtTime(isCorrect ? 523 : 220, audioCtx.currentTime);
        gain.gain.setValueAtTime(0.05, audioCtx.currentTime);
        osc.start(); osc.stop(audioCtx.currentTime + 0.2);
    }

    function toggleSettings() {
        const content = document.getElementById('settings-content');
        content.style.display = (content.style.display === "block") ? "none" : "block";
    }

    function saveAndRestart() {
        const input = document.getElementById('words-input').value.trim();
        if (!input) return;
        fullDatabase = input.split('\n').map(line => {
            const parts = line.split(',');
            if (parts.length < 2) return null;
            const parse = (str) => {
                const match = str.match(/(.+)\((.+)\)/);
                return match ? { raw: str, main: match[1].trim(), ying: match[2].trim() } : { raw: str, main: str.trim(), ying: "" };
            };
            return { charObj: parse(parts[0]), radObj: parse(parts[1]) };
        }).filter(i => i);
        localStorage.setItem('myWordsFinal_V2', input);
        document.getElementById('settings-content').style.display = "none";
        initGame();
    }

    function initGame() {
        let saved = localStorage.getItem('myWordsFinal_V2');
        if (!saved) {
            saved = defaultWords;
            localStorage.setItem('myWordsFinal_V2', saved);
        }
        document.getElementById('words-input').value = saved;
        if (fullDatabase.length === 0) { saveAndRestart(); return; }
        score = 0; currentIdx = 0; wrongList = [];
        pointsPerWord = 100 / fullDatabase.length;
        currentQuestions = [...fullDatabase].sort(() => Math.random() - 0.5);
        document.getElementById('game-screen').style.display = 'block';
        document.getElementById('result-screen').style.display = 'none';
        showQuestion();
    }

    function showQuestion() {
        if (currentIdx >= currentQuestions.length) return showResult();
        hasMistake = false;
        const q = currentQuestions[currentIdx];
        document.getElementById('display-char').innerText = q.charObj.main;
        renderZhuyin(q.charObj.ying, "zy-box-main");
        document.getElementById('score-display').innerText = `åˆ†æ•¸: ${Math.round(score)}`;
        document.getElementById('progress-display').innerText = `é¡Œç›®: ${currentIdx + 1} / ${currentQuestions.length}`;
        
        let correctOpt = q.radObj.raw;
        let options = [correctOpt];
        const common = ["æ°´(ã„•ã„¨ã„ŸË‡)","æœ¨(ã„‡ã„‡Ë‹)","æ‰‹(ã„•ã„¡Ë‡)","å¿ƒ(ã„’ã„§ã„£)","è¨€(ã„§ã„¢ËŠ)","å£(ã„ã„¡Ë‡)","äºº(ã„–ã„£ËŠ)","åœŸ(ã„Šã„¨Ë‡)","åˆ€(ã„‰ã„ )","è‰¸(ã„˜ã„ Ë‡)"];
        while(options.length < 4) {
            let r = common[Math.floor(Math.random() * common.length)];
            if(!options.includes(r)) options.push(r);
        }
        options.sort(() => Math.random() - 0.5);

        const grid = document.getElementById('options');
        grid.innerHTML = "";
        options.forEach(opt => {
            const btn = document.createElement('button');
            const m = opt.match(/(.+)\((.+)\)/);
            btn.innerHTML = m ? `<span class="btn-char">${m[1]}</span>${getZhuyinHTML(m[2])}` : `<span class="btn-char">${opt}</span>`;
            btn.onclick = () => {
                if (opt === correctOpt) {
                    playSound(true);
                    btn.classList.add('correct');
                    if (!hasMistake) score += pointsPerWord;
                    currentIdx++;
                    setTimeout(showQuestion, 800);
                } else {
                    playSound(false);
                    btn.classList.add('wrong');
                    if (!hasMistake) wrongList.push(q);
                    hasMistake = true;
                    setTimeout(() => btn.classList.remove('wrong'), 500);
                }
            };
            grid.appendChild(btn);
        });
    }

    function showResult() {
        document.getElementById('game-screen').style.display = 'none';
        document.getElementById('result-screen').style.display = 'block';
        document.getElementById('final-score').innerText = (wrongList.length === 0) ? 100 : Math.min(99, Math.round(score));
        if (wrongList.length > 0) {
            document.getElementById('wrong-report').innerHTML = wrongList.map(i => `${i.charObj.raw} â” ${i.radObj.raw}`).join('<br>');
            document.getElementById('wrong-list-container').style.display = 'block';
        }
    }
    window.onload = initGame;
</script>
</body>
</html>